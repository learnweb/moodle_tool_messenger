{"version":3,"sources":["../src/options.js"],"names":["define","$","modal_factory","url","append","form_id","name","value","attr","appendTo","show_message","event","preventDefault","button","currentTarget","id","getAttribute","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","data","JSON","parse","responseText","create","type","types","ALERT","title","subject","body","message","then","modal","show","s","relativeUrl","open","send","initialize_showmessage_buttons","each","i","x","on","init_predicitonlink","click","parent","length","val","roles","children","push","unix","prop","day","month","year","Math","floor","Date","getTime","join","text","init","document","ready","remove","input","split"],"mappings":"+qCAAAA,OAAM,0BAAC,CAAC,QAAD,CAAW,oBAAX,CAAiC,UAAjC,CAAD,CAA+C,SAAUC,CAAV,CAAaC,CAAb,CAA4BC,CAA5B,CAAiC,IAE9EC,CAAAA,CAAM,CAAG,SAASC,CAAT,CAAkBC,CAAlB,CAAwBC,CAAxB,CAA+B,CACxC,MAAO,WAAW,CACdN,CAAC,CAAC,WAAD,CAAD,CAAeO,IAAf,CAAoB,MAApB,CAA4B,QAA5B,EACKA,IADL,CACU,MADV,CACkBF,CADlB,EAEKE,IAFL,CAEU,OAFV,CAEmBD,CAFnB,EAGKE,QAHL,CAGc,IAAMJ,CAHpB,CAIH,CACJ,CATiF,CAW9EK,CAAY,CAAG,SAAUC,CAAV,CAAiB,CAChCA,CAAK,CAACC,cAAN,GADgC,GAE5BC,CAAAA,CAAM,CAAGF,CAAK,CAACG,aAFa,CAG5BC,CAAE,CAAGF,CAAM,CAACG,YAAP,CAAoB,WAApB,CAHuB,CAI5BC,CAAK,CAAG,GAAIC,CAAAA,cAJgB,CAKhCD,CAAK,CAACE,kBAAN,CAA2B,UAAY,CACnC,GAAwB,CAApB,QAAKC,UAAL,EAAyC,GAAhB,QAAKC,MAAlC,CAAkD,CAC9C,GAAIC,CAAAA,CAAI,CAAGC,IAAI,CAACC,KAAL,CAAW,KAAKC,YAAhB,CAAX,CACAvB,CAAa,CAACwB,MAAd,CAAqB,CACjBC,IAAI,CAAEzB,CAAa,CAAC0B,KAAd,CAAoBC,KADT,CAEjBC,KAAK,CAAER,CAAI,CAACS,OAFK,CAGjBC,IAAI,CAAEV,CAAI,CAACW,OAHM,CAArB,EAIGC,IAJH,CAIQ,SAAUC,CAAV,CAAiB,CACrBA,CAAK,CAACC,IAAN,EACH,CAND,CAOH,CACJ,CAXD,CAYA,GAAIC,CAAAA,CAAC,CAAGlC,CAAG,CAACmC,WAAJ,CAAgB,4CAAhB,CAA8D,CAAC,GAAMvB,CAAP,CAA9D,IAAR,CACAE,CAAK,CAACsB,IAAN,CAAW,KAAX,CAAkBF,CAAlB,EACApB,CAAK,CAACuB,IAAN,EACH,CA/BiF,CAiC9EC,CAA8B,CAAG,UAAY,CAC7CxC,CAAC,CAAC,0BAAD,CAAD,CAA8ByC,IAA9B,CAAmC,SAASC,CAAT,CAAYC,CAAZ,CAAe,CAC9C3C,CAAC,CAAC2C,CAAD,CAAD,CAAKC,EAAL,CAAQ,OAAR,CAAiBnC,CAAjB,EACA,QACH,CAHD,CAIH,CAtCiF,CAwC9EoC,CAAmB,CAAG,UAAY,CAClC7C,CAAC,CAAC,oBAAD,CAAD,CAAwB8C,KAAxB,CAA8B,SAAUpC,CAAV,CAAiB,CAC3CA,CAAK,CAACC,cAAN,GAD2C,GAEvCyB,CAAAA,CAFuC,CAGvCW,CAAM,CAAG/C,CAAC,CAAC,cAAD,CAH6B,CAI3C,GAAoB,CAAhB,CAAA+C,CAAM,CAACC,MAAX,CAAuB,CACnBZ,CAAC,CAAGlC,CAAG,CAACmC,WAAJ,CAAgB,uDAAhB,CACA,CAAC,SAAYU,CAAM,CAACE,GAAP,EAAb,CADA,IAEP,CAHD,IAGO,CACH,GAAIC,CAAAA,CAAK,CAAG,EAAZ,CACAlD,CAAC,CAAC,gBAAD,CAAD,CAAoBmD,QAApB,CAA6B,WAA7B,EAA0CV,IAA1C,CAA+C,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CAC3DO,CAAK,CAACE,IAAN,CAAWT,CAAC,CAACrC,KAAb,CACH,CAFD,EAGA,GAAI+C,CAAAA,CAAJ,CACA,GAAIrD,CAAC,CAAC,qBAAD,CAAD,CAAyBsD,IAAzB,CAA8B,SAA9B,CAAJ,CAA8C,IACtCC,CAAAA,CAAG,CAAGvD,CAAC,CAAC,uBAAD,CAAD,CAA2BiD,GAA3B,EADgC,CAEtCO,CAAK,CAAGxD,CAAC,CAAC,yBAAD,CAAD,CAA6BiD,GAA7B,EAF8B,CAGtCQ,CAAI,CAAGzD,CAAC,CAAC,wBAAD,CAAD,CAA4BiD,GAA5B,EAH+B,CAI1CI,CAAI,CAAGK,IAAI,CAACC,KAAL,CAAW,GAAIC,CAAAA,IAAJ,CAASH,CAAI,CAAG,GAAP,CAAaD,CAAb,CAAqB,GAArB,CAA2BD,CAApC,EAAyCM,OAAzC,GAAqD,GAAhE,CACV,CALD,IAKO,CACHR,CAAI,CAAG,CAAC,CACX,CACDjB,CAAC,CAAGlC,CAAG,CAACmC,WAAJ,CAAgB,uDAAhB,CACA,CAAC,MAASa,CAAK,CAACY,IAAN,CAAW,GAAX,CAAV,CAA2B,aAAgBT,CAA3C,CADA,IAEP,CACD,GAAIrC,CAAAA,CAAK,CAAG,GAAIC,CAAAA,cAAhB,CACAD,CAAK,CAACE,kBAAN,CAA2B,UAAY,CACnC,GAAwB,CAApB,QAAKC,UAAL,EAAyC,GAAhB,QAAKC,MAAlC,CAAkD,CAC9CpB,CAAC,CAAC,gBAAD,CAAD,CAAoB+D,IAApB,CAAyB,KAAKvC,YAA9B,CACH,CACJ,CAJD,CAKAR,CAAK,CAACsB,IAAN,CAAW,KAAX,CAAkBF,CAAlB,EACApB,CAAK,CAACuB,IAAN,EACH,CAhCD,CAiCH,CA1EiF,CA+FlF,MAAO,CACHyB,IAAI,CApBG,QAAPA,CAAAA,IAAO,EAAW,CAClBhE,CAAC,CAACiE,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAW,CACzBlE,CAAC,CAAC,gCAAD,CAAD,CAAoCyC,IAApC,CAAyC,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CACrDA,CAAC,CAACwB,MAAF,EACH,CAFD,EAGAnE,CAAC,CAAC,mCAAD,CAAD,CAAuCyC,IAAvC,CAA4C,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CACxDA,CAAC,CAACwB,MAAF,EACH,CAFD,EAGAnE,CAAC,CAAC,YAAD,CAAD,CAAgByC,IAAhB,CAAqB,SAAUC,CAAV,CAAa0B,CAAb,CAAoB,IACjCxD,CAAAA,CAAM,CAAGZ,CAAC,CAACoE,CAAD,CADuB,GAEjBA,CAAK,GAAL,CAAYC,KAAZ,CAAkB,GAAlB,CAFiB,uBAEhChE,CAFgC,MAE1BC,CAF0B,MAGrCM,CAAM,CAACgC,EAAP,CAAU,OAAV,CAAmBzC,CAAM,CAACH,CAAC,CAAC,YAAD,CAAD,CAAgB,CAAhB,EAAmBc,EAApB,CAAwBT,CAAxB,CAA8BC,CAA9B,CAAzB,EACA,QACH,CALD,EAMAkC,CAA8B,GAC9BK,CAAmB,EACtB,CAfD,CAgBH,CAEM,CAGV,CAlGK,CAAN","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/url'], function ($, modal_factory, url) {\n\n    var append = function(form_id, name, value) {\n        return function() {\n            $(\"<input />\").attr(\"type\", \"hidden\")\n                .attr(\"name\", name)\n                .attr(\"value\", value)\n                .appendTo(\"#\" + form_id);\n        };\n    };\n\n    var show_message = function (event) {\n        event.preventDefault();\n        var button = event.currentTarget;\n        var id = button.getAttribute(\"messageid\");\n        var xhttp = new XMLHttpRequest();\n        xhttp.onreadystatechange = function () {\n            if (this.readyState === 4 && this.status === 200) {\n                var data = JSON.parse(this.responseText);\n                modal_factory.create({\n                    type: modal_factory.types.ALERT,\n                    title: data.subject,\n                    body: data.message\n                }).then(function (modal) {\n                    modal.show();\n                });\n            }\n        };\n        var s = url.relativeUrl(\"/admin/tool/messenger/get_message_ajax.php\", {'id': id}, true);\n        xhttp.open(\"GET\", s);\n        xhttp.send();\n    };\n\n    var initialize_showmessage_buttons = function () {\n        $('button.showmessagebutton').each(function(i, x) {\n            $(x).on('click', show_message);\n            return true;\n        });\n    };\n\n    var init_predicitonlink = function () {\n        $('#predictiontrigger').click(function (event) {\n            event.preventDefault();\n            var s;\n            var parent = $('#id_followup');\n            if (parent.length > 0) {\n                s = url.relativeUrl(\"/admin/tool/messenger/predict_affected_users_ajax.php\",\n                    {'parentid': parent.val()}, true);\n            } else {\n                var roles = [];\n                $('#id_recipients').children(':selected').each(function (i, x) {\n                    roles.push(x.value);\n                });\n                var unix;\n                if ($('#id_knockout_enable').prop('checked')) {\n                    var day = $('#id_knockout_date_day').val();\n                    var month = $('#id_knockout_date_month').val();\n                    var year = $('#id_knockout_date_year').val();\n                    unix = Math.floor(new Date(year + \".\" + month + \".\" + day).getTime() / 1000);\n                } else {\n                    unix = -1;\n                }\n                s = url.relativeUrl(\"/admin/tool/messenger/predict_affected_users_ajax.php\",\n                    {'roles': roles.join(\",\"), 'knockoutdate': unix}, true);\n            }\n            var xhttp = new XMLHttpRequest();\n            xhttp.onreadystatechange = function () {\n                if (this.readyState === 4 && this.status === 200) {\n                    $('#predictionbox').text(this.responseText);\n                }\n            };\n            xhttp.open(\"GET\", s);\n            xhttp.send();\n        });\n    };\n\n    var init = function() {\n        $(document).ready(function() {\n            $('input[name=abort][type=hidden]').each(function (i, x) {\n                x.remove();\n            });\n            $('input[name=followup][type=hidden]').each(function (i, x) {\n                x.remove();\n            });\n            $('td > input').each(function (i, input) {\n                var button = $(input);\n                var [name, value] = input[\"id\"].split('_');\n                button.on('click', append($('form.mform')[0].id, name, value));\n                return true;\n            });\n            initialize_showmessage_buttons();\n            init_predicitonlink();\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"options.min.js"}