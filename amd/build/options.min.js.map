{"version":3,"sources":["../src/options.js"],"names":["define","$","modal_factory","url","append","form_id","name","value","attr","appendTo","atto_html_mode","observer","MutationObserver","mutations","forEach","mutation","addedNodes","i","node","length","title","click","disconnect","observe","document","body","childList","subtree","attributes","characterData","show_message","event","preventDefault","button","currentTarget","id","getAttribute","xhttp","XMLHttpRequest","onreadystatechange","readyState","status","data","JSON","parse","responseText","create","type","types","ALERT","subject","message","then","modal","show","s","relativeUrl","open","send","initialize_showmessage_buttons","each","x","on","init_predicitonlink","parent","val","roles","children","push","unix","prop","day","month","year","Math","floor","Date","getTime","join","text","init","ready","remove","input","split"],"mappings":"+qCAAAA,OAAM,0BAAC,CAAC,QAAD,CAAW,oBAAX,CAAiC,UAAjC,CAAD,CAA+C,SAAUC,CAAV,CAAaC,CAAb,CAA4BC,CAA5B,CAAiC,IAE9EC,CAAAA,CAAM,CAAG,SAASC,CAAT,CAAkBC,CAAlB,CAAwBC,CAAxB,CAA+B,CACxC,MAAO,WAAW,CACdN,CAAC,CAAC,WAAD,CAAD,CAAeO,IAAf,CAAoB,MAApB,CAA4B,QAA5B,EACKA,IADL,CACU,MADV,CACkBF,CADlB,EAEKE,IAFL,CAEU,OAFV,CAEmBD,CAFnB,EAGKE,QAHL,CAGc,IAAMJ,CAHpB,CAIH,CACJ,CATiF,CAW9EK,CAAc,CAAG,UAAY,CAC7B,GAAIC,CAAAA,CAAQ,CAAG,GAAIC,CAAAA,gBAAJ,CAAqB,SAACC,CAAD,CAAe,CAC/CA,CAAS,CAACC,OAAV,CAAkB,SAACC,CAAD,CAAc,CAC5B,GAAI,CAACA,CAAQ,CAACC,UAAd,CAA0B,CACtB,MACH,CACD,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACGC,CADR,CAAgBD,CAAC,CAAGF,CAAQ,CAACC,UAAT,CAAoBG,MAAxC,CAAgDF,CAAC,EAAjD,CAAqD,CAC7CC,CAD6C,CACtCH,CAAQ,CAACC,UAAT,CAAoBC,CAApB,CADsC,CAEjD,GAAIC,CAAI,EAAIA,CAAI,CAACE,KAAb,EAAoC,MAAd,EAAAF,CAAI,CAACE,KAA/B,CAAgD,CAC5C,GAA4D,CAAxD,EAAAnB,CAAC,CAAC,0CAAD,CAAD,CAA8CkB,MAAlD,CAA+D,CAC3DD,CAAI,CAACG,KAAL,EACH,CACDV,CAAQ,CAACW,UAAT,EACH,CACJ,CACJ,CAbD,CAcH,CAfc,CAAf,CAiBAX,CAAQ,CAACY,OAAT,CAAiBC,QAAQ,CAACC,IAA1B,CAAgC,CAC5BC,SAAS,GADmB,CAE5BC,OAAO,GAFqB,CAG5BC,UAAU,GAHkB,CAI5BC,aAAa,GAJe,CAAhC,CAMH,CAnCiF,CAqC9EC,CAAY,CAAG,SAAUC,CAAV,CAAiB,CAChCA,CAAK,CAACC,cAAN,GADgC,GAE5BC,CAAAA,CAAM,CAAGF,CAAK,CAACG,aAFa,CAG5BC,CAAE,CAAGF,CAAM,CAACG,YAAP,CAAoB,WAApB,CAHuB,CAI5BC,CAAK,CAAG,GAAIC,CAAAA,cAJgB,CAKhCD,CAAK,CAACE,kBAAN,CAA2B,UAAY,CACnC,GAAwB,CAApB,QAAKC,UAAL,EAAyC,GAAhB,QAAKC,MAAlC,CAAkD,CAC9C,GAAIC,CAAAA,CAAI,CAAGC,IAAI,CAACC,KAAL,CAAW,KAAKC,YAAhB,CAAX,CACA3C,CAAa,CAAC4C,MAAd,CAAqB,CACjBC,IAAI,CAAE7C,CAAa,CAAC8C,KAAd,CAAoBC,KADT,CAEjB7B,KAAK,CAAEsB,CAAI,CAACQ,OAFK,CAGjBzB,IAAI,CAAEiB,CAAI,CAACS,OAHM,CAArB,EAIGC,IAJH,CAIQ,SAAUC,CAAV,CAAiB,CACrBA,CAAK,CAACC,IAAN,EACH,CAND,CAOH,CACJ,CAXD,CAYA,GAAIC,CAAAA,CAAC,CAAGpD,CAAG,CAACqD,WAAJ,CAAgB,4CAAhB,CAA8D,CAAC,GAAMrB,CAAP,CAA9D,IAAR,CACAE,CAAK,CAACoB,IAAN,CAAW,KAAX,CAAkBF,CAAlB,EACAlB,CAAK,CAACqB,IAAN,EACH,CAzDiF,CA2D9EC,CAA8B,CAAG,UAAY,CAC7C1D,CAAC,CAAC,0BAAD,CAAD,CAA8B2D,IAA9B,CAAmC,SAAS3C,CAAT,CAAY4C,CAAZ,CAAe,CAC9C5D,CAAC,CAAC4D,CAAD,CAAD,CAAKC,EAAL,CAAQ,OAAR,CAAiBhC,CAAjB,EACA,QACH,CAHD,CAIH,CAhEiF,CAkE9EiC,CAAmB,CAAG,UAAY,CAClC9D,CAAC,CAAC,oBAAD,CAAD,CAAwBoB,KAAxB,CAA8B,SAAUU,CAAV,CAAiB,CAC3CA,CAAK,CAACC,cAAN,GAD2C,GAEvCuB,CAAAA,CAFuC,CAGvCS,CAAM,CAAG/D,CAAC,CAAC,cAAD,CAH6B,CAI3C,GAAoB,CAAhB,CAAA+D,CAAM,CAAC7C,MAAX,CAAuB,CACnBoC,CAAC,CAAGpD,CAAG,CAACqD,WAAJ,CAAgB,uDAAhB,CACA,CAAC,SAAYQ,CAAM,CAACC,GAAP,EAAb,CADA,IAEP,CAHD,IAGO,CACH,GAAIC,CAAAA,CAAK,CAAG,EAAZ,CACAjE,CAAC,CAAC,gBAAD,CAAD,CAAoBkE,QAApB,CAA6B,WAA7B,EAA0CP,IAA1C,CAA+C,SAAU3C,CAAV,CAAa4C,CAAb,CAAgB,CAC3DK,CAAK,CAACE,IAAN,CAAWP,CAAC,CAACtD,KAAb,CACH,CAFD,EAGA,GAAI8D,CAAAA,CAAJ,CACA,GAAIpE,CAAC,CAAC,qBAAD,CAAD,CAAyBqE,IAAzB,CAA8B,SAA9B,CAAJ,CAA8C,IACtCC,CAAAA,CAAG,CAAGtE,CAAC,CAAC,uBAAD,CAAD,CAA2BgE,GAA3B,EADgC,CAEtCO,CAAK,CAAGvE,CAAC,CAAC,yBAAD,CAAD,CAA6BgE,GAA7B,EAF8B,CAGtCQ,CAAI,CAAGxE,CAAC,CAAC,wBAAD,CAAD,CAA4BgE,GAA5B,EAH+B,CAI1CI,CAAI,CAAGK,IAAI,CAACC,KAAL,CAAW,GAAIC,CAAAA,IAAJ,CAASH,CAAI,CAAG,GAAP,CAAaD,CAAb,CAAqB,GAArB,CAA2BD,CAApC,EAAyCM,OAAzC,GAAqD,GAAhE,CACV,CALD,IAKO,CACHR,CAAI,CAAG,CAAC,CACX,CACDd,CAAC,CAAGpD,CAAG,CAACqD,WAAJ,CAAgB,uDAAhB,CACA,CAAC,MAASU,CAAK,CAACY,IAAN,CAAW,GAAX,CAAV,CAA2B,aAAgBT,CAA3C,CADA,IAEP,CACD,GAAIhC,CAAAA,CAAK,CAAG,GAAIC,CAAAA,cAAhB,CACAD,CAAK,CAACE,kBAAN,CAA2B,UAAY,CACnC,GAAwB,CAApB,QAAKC,UAAL,EAAyC,GAAhB,QAAKC,MAAlC,CAAkD,CAC9CxC,CAAC,CAAC,gBAAD,CAAD,CAAoB8E,IAApB,CAAyB,KAAKlC,YAA9B,CACH,CACJ,CAJD,CAKAR,CAAK,CAACoB,IAAN,CAAW,KAAX,CAAkBF,CAAlB,EACAlB,CAAK,CAACqB,IAAN,EACH,CAhCD,CAiCH,CApGiF,CA0HlF,MAAO,CACHsB,IAAI,CArBG,QAAPA,CAAAA,IAAO,EAAW,CAClB/E,CAAC,CAACuB,QAAD,CAAD,CAAYyD,KAAZ,CAAkB,UAAW,CACzBhF,CAAC,CAAC,gCAAD,CAAD,CAAoC2D,IAApC,CAAyC,SAAU3C,CAAV,CAAa4C,CAAb,CAAgB,CACrDA,CAAC,CAACqB,MAAF,EACH,CAFD,EAGAjF,CAAC,CAAC,mCAAD,CAAD,CAAuC2D,IAAvC,CAA4C,SAAU3C,CAAV,CAAa4C,CAAb,CAAgB,CACxDA,CAAC,CAACqB,MAAF,EACH,CAFD,EAGAjF,CAAC,CAAC,YAAD,CAAD,CAAgB2D,IAAhB,CAAqB,SAAU3C,CAAV,CAAakE,CAAb,CAAoB,IACjClD,CAAAA,CAAM,CAAGhC,CAAC,CAACkF,CAAD,CADuB,GAEjBA,CAAK,GAAL,CAAYC,KAAZ,CAAkB,GAAlB,CAFiB,uBAEhC9E,CAFgC,MAE1BC,CAF0B,MAGrC0B,CAAM,CAAC6B,EAAP,CAAU,OAAV,CAAmB1D,CAAM,CAACH,CAAC,CAAC,YAAD,CAAD,CAAgB,CAAhB,EAAmBkC,EAApB,CAAwB7B,CAAxB,CAA8BC,CAA9B,CAAzB,EACA,QACH,CALD,EAMAoD,CAA8B,GAC9BI,CAAmB,GACnBrD,CAAc,EACjB,CAhBD,CAiBH,CAEM,CAGV,CA7HK,CAAN","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/url'], function ($, modal_factory, url) {\n\n    var append = function(form_id, name, value) {\n        return function() {\n            $(\"<input />\").attr(\"type\", \"hidden\")\n                .attr(\"name\", name)\n                .attr(\"value\", value)\n                .appendTo(\"#\" + form_id);\n        };\n    };\n\n    var atto_html_mode = function () {\n        let observer = new MutationObserver((mutations) => {\n            mutations.forEach((mutation) => {\n                if (!mutation.addedNodes) {\n                    return;\n                }\n                for (let i = 0; i < mutation.addedNodes.length; i++) {\n                    let node = mutation.addedNodes[i];\n                    if (node && node.title && node.title == \"HTML\") {\n                        if ($('.CodeMirror.cm-s-default.CodeMirror-wrap').length == 0) {\n                            node.click();\n                        }\n                        observer.disconnect();\n                    }\n                }\n            });\n        });\n\n        observer.observe(document.body, {\n            childList: true,\n            subtree: true,\n            attributes: false,\n            characterData: false\n        });\n    };\n\n    var show_message = function (event) {\n        event.preventDefault();\n        var button = event.currentTarget;\n        var id = button.getAttribute(\"messageid\");\n        var xhttp = new XMLHttpRequest();\n        xhttp.onreadystatechange = function () {\n            if (this.readyState === 4 && this.status === 200) {\n                var data = JSON.parse(this.responseText);\n                modal_factory.create({\n                    type: modal_factory.types.ALERT,\n                    title: data.subject,\n                    body: data.message\n                }).then(function (modal) {\n                    modal.show();\n                });\n            }\n        };\n        var s = url.relativeUrl(\"/admin/tool/messenger/get_message_ajax.php\", {'id': id}, true);\n        xhttp.open(\"GET\", s);\n        xhttp.send();\n    };\n\n    var initialize_showmessage_buttons = function () {\n        $('button.showmessagebutton').each(function(i, x) {\n            $(x).on('click', show_message);\n            return true;\n        });\n    };\n\n    var init_predicitonlink = function () {\n        $('#predictiontrigger').click(function (event) {\n            event.preventDefault();\n            var s;\n            var parent = $('#id_followup');\n            if (parent.length > 0) {\n                s = url.relativeUrl(\"/admin/tool/messenger/predict_affected_users_ajax.php\",\n                    {'parentid': parent.val()}, true);\n            } else {\n                var roles = [];\n                $('#id_recipients').children(':selected').each(function (i, x) {\n                    roles.push(x.value);\n                });\n                var unix;\n                if ($('#id_knockout_enable').prop('checked')) {\n                    var day = $('#id_knockout_date_day').val();\n                    var month = $('#id_knockout_date_month').val();\n                    var year = $('#id_knockout_date_year').val();\n                    unix = Math.floor(new Date(year + \".\" + month + \".\" + day).getTime() / 1000);\n                } else {\n                    unix = -1;\n                }\n                s = url.relativeUrl(\"/admin/tool/messenger/predict_affected_users_ajax.php\",\n                    {'roles': roles.join(\",\"), 'knockoutdate': unix}, true);\n            }\n            var xhttp = new XMLHttpRequest();\n            xhttp.onreadystatechange = function () {\n                if (this.readyState === 4 && this.status === 200) {\n                    $('#predictionbox').text(this.responseText);\n                }\n            };\n            xhttp.open(\"GET\", s);\n            xhttp.send();\n        });\n    };\n\n    var init = function() {\n        $(document).ready(function() {\n            $('input[name=abort][type=hidden]').each(function (i, x) {\n                x.remove();\n            });\n            $('input[name=followup][type=hidden]').each(function (i, x) {\n                x.remove();\n            });\n            $('td > input').each(function (i, input) {\n                var button = $(input);\n                var [name, value] = input[\"id\"].split('_');\n                button.on('click', append($('form.mform')[0].id, name, value));\n                return true;\n            });\n            initialize_showmessage_buttons();\n            init_predicitonlink();\n            atto_html_mode();\n        });\n    };\n\n    return {\n        init: init\n    };\n});"],"file":"options.min.js"}